<!DOCTYPE html>
<html>
    <head>
        <title>jsPsych Demo</title>
        <!--imports-->
        <script src="https://unpkg.com/jspsych@7.3.0"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.1"></script>
        <!--Style sheet import-->
        <link href="https://unpkg.com/jspsych@7.3.0/css/jspsych.css" rel="stylesheet" type="text/css" />
        <!--Import stimuli ** UNUSED **-->
        <script src="practice.js"></script> 
        <script src="stimuli.js"></script>
        <!--Import lists-->
        <script src="list-1.js"></script>
        <script src="list-2.js"></script>
        <script src="list-3.js"></script>
        <script src="list-4.js"></script>
        <script src="images.js"></script>
    </head>
    <body>
        <script>

            var jsPsych = initJsPsych({
                // on_finish: function(){ 
                //     jsPsych.data.displayData(); // Added data display after trial for testing
                // }
            });
            
            //Generate a random user ID
            var subject_id = Math.floor(Math.random()*100000);

            // WELCOME SCREEN
            var welcome_screen = {
                type: jsPsychHtmlButtonResponse,
                stimulus: "<p> Welcome to the experiment! Instructions will be on this screen.</p>",
                choices: ['Begin Experiment'],
                data: {
                    typeoftrial: 'instruction',
                    subject_id: subject_id
                }
            }

            // PRELOAD IMAGES
            var preload = {
                    type: jsPsychPreload,
                    images: imagelist, // ** NOT INITIALIZED ** 
                    show_progress_bar: true,
                    data: {
                        typeoftrial: 'preload',
                        subject: subject_id
                    }
                };
            
            // FIXATION CROSS 1
            var fixation1 = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: '<p style="font-size : 48px">+</p>',
                choices: "NO_KEYS",
                trial_duration: 1000,
                data: {
                typeoftrial: 'fixation',
                // list_number: jsPsych.timelineVariable('List'),
                trialcondition: jsPsych.timelineVariable('condition'),
                subject: subject_id
                }
            }
            
            // SENTENCE
            var sentence = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: jsPsych.timelineVariable('sentence'),
                // press spacebar to continue
                choices: " ", 
                data: {
                typeoftrial: 'sentence',
                // list_number: jsPsych.timelineVariable('List'),
                trialcondition: jsPsych.timelineVariable('condition'),
                subject: subject_id
                }
            }
            
            // FIXATION CROSS 2
            var fixation2 = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: '<p style="font-size : 48px">+</p>',
                choices: "NO_KEYS",
                trial_duration: 500,
                data: {
                typeoftrial: 'fixation',
                // list_number: jsPsych.timelineVariable('List'),
                trialcondition: jsPsych.timelineVariable('condition'),
                subject: subject_id
                }
            }
            
            // IMAGE
            var picture = {
                type: jsPsychImageKeyboardResponse,
                stimulus: jsPsych.timelineVariable('image_path'),
                stimulus_width: 300,
                choices: ['A', 'L', 'a', 'l'],
                data: {
                typeoftrial: 'picture',
                // list_number: jsPsych.timelineVariable('List'),
                trialcondition: jsPsych.timelineVariable('condition'),
                subject: subject_id,
                },
                // score the response as correct or incorrect. // ** EXPERIMENTAL CONDITION ONLY - DOES NOT TRACK CORRECT 'NO' RESPONSES **
                on_finish: function(data){
                        if(jsPsych.pluginAPI.compareKeys(data.response, 'A')){
                            //data.response = 'S' or 'N' entered
                            data.correct = true;
                        } else {data.correct = false;}
                    }
            }
            
            // ** NO FEEDBACK FUNCTIONALITY **
            // FEEDBACK STIMULI tells whether P's entered correct response
            // var feedback = {
            //         type: jsPsychHtmlKeyboardResponse,
            //         stimulus: function () {
            //             // obtaining the value previously stored in data.correcty but only for the most recent trial 
            //             var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct; 
            //             if (last_trial_correct) { return "CORRECT!"; }
            //             else {
            //                 return "WRONG!";
            //             }
            //         },
            //         choices: "NO_KEYS",
            //         trial_duration: 2000
                // }
            
            // PRACTICE PROCEDURE ** INCOMPLETE **
            // var practice_procedure = {
            //         timeline: [fixation1, sentence, fixation2, picture, feedback],
            //         timeline_variables: practicestimuli,
            //         randomize_order: true
            //     };

            // END SCREEN
            var end_experiment = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: "Thank you for participating! Click any key to end the experiment."
            }
            
            // ASSIGN A LIST 
            var list = [1,2,3,4];
            // We do it randomly on local. You can comment this out and cognition.run automatically creates even dist of conditions
            var CONDITION = list[Math.floor(Math.random() * list.length)]; // rando selects a number from 1-4 
            // Selects the list off of the random number
            var teststimuli = [] 
            if(CONDITION == 1){teststimuli = list1}
            else if(CONDITION == 2){teststimuli = list2}
            else if(CONDITION == 3){teststimuli = list3}
            else{teststimuli = list4}
            
            // Test checks. Prints list, condition, and test stimuli to the html console. 
            // console.log("list=", list)
            // console.log("CONDITION=", CONDITION)
            // console.log("teststimuli=", teststimuli)
            // console.log("picture=", picture)

            // PLUGIN CALLS. Pass in the array of plugins to run. Remember to pass in all the plugins.
            var experiment_procedure = {
                timeline: [fixation1, sentence, fixation2, picture], // The events we defined
                timeline_variables: teststimuli, // Now the random list 
                randomize_order: true // rando order shown to participants
            };

            jsPsych.run([preload, welcome_screen, experiment_procedure, end_experiment]);

        </script>
    </body>
</html>